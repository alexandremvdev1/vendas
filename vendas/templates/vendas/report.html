<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Relat√≥rio de Vendas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --brand:#2563eb; --line:#e5e7eb;
      --card:#ffffff; --bg:#f6f8fb; --ok:#16a34a; --warn:#f59e0b;
      --base-font:14px; /* ‚Üì tipografia menor no site todo */
    }
    html{ font-size:var(--base-font); }
    body{ background:var(--bg); color:var(--ink); }

    .nav-lite{
      background:
        radial-gradient(800px 400px at -10% -50%, rgba(37,99,235,.25), transparent),
        radial-gradient(800px 400px at 110% -50%, rgba(16,185,129,.18), transparent),
        linear-gradient(90deg, #0b1020, #0f172a);
      box-shadow:0 6px 20px rgba(2,6,23,.35);
    }
    .navbar-brand{ font-size:1rem; }
    .navbar .btn{ font-size:.85rem; padding:.25rem .6rem; }

    .page-head{ display:flex; align-items:center; gap:.75rem; justify-content:space-between; }
    .page-head .title{ margin:0; font-weight:800; letter-spacing:.3px; }
    .sub{ color:var(--muted); }

    .card-clean{ background:var(--card); border:none; border-radius:1rem; box-shadow:0 10px 24px rgba(17,24,39,.06); }
    .filter-card{ border:1px solid var(--line); }

    .metric{
      display:flex; gap:.75rem; align-items:center;
      padding:.8rem 1rem; border:1px solid var(--line); border-radius:.9rem; background:#fff;
    }
    .metric .ico{ font-size:1.05rem; }
    .metric .val{ font-weight:800; font-size:1rem; } /* n√∫meros mais discretos */
    .text-muted.small{ font-size:.8rem !important; }

    .form-control, .form-select{ font-size:.875rem; padding:.375rem .5rem; }
    .btn{ font-size:.875rem; }
    .back-btn{ border-radius:.6rem; }

    .table{ font-size:.875rem; }
    .table thead th{ position:sticky; top:0; background:#fff; z-index:1; font-size:.8rem; text-transform:uppercase; letter-spacing:.04em; color:#64748b; }
  </style>
</head>
<body>

<nav class="navbar nav-lite navbar-dark">
  <div class="container d-flex align-items-center gap-3">
    <a class="navbar-brand fw-bold" href="{% url 'home' %}">YLA Criativa</a>
    <div class="ms-auto d-none d-md-flex align-items-center gap-3">
      {% if user.is_authenticated %}
        {% if user.is_staff %}<a class="link-light text-decoration-none" href="{% url 'sales_report' %}">Relat√≥rio</a>{% endif %}
        <span class="text-light small">Ol√°, {{ user.username }}</span>
        <a class="btn btn-outline-light btn-sm" href="{% url 'logout' %}">Sair</a>
      {% else %}
        <a class="btn btn-outline-light btn-sm" href="{% url 'login' %}">Entrar</a>
      {% endif %}
    </div>
  </div>
</nav>

<main class="container py-4 py-md-5">
  <!-- Cabe√ßalho da p√°gina -->
  <div class="page-head mb-3">
    <div class="d-flex align-items-center gap-2">
      <button type="button" class="btn btn-outline-secondary btn-sm back-btn" onclick="history.back()" aria-label="Voltar">‚Üê Voltar</button>
      <div>
        <h1 class="h4 title">Relat√≥rio de Vendas</h1>
        <div class="sub small">Acompanhe pedidos, pagamentos e receita por per√≠odo.</div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="card card-clean filter-card mb-3">
    <div class="card-body">
      <form class="row g-2 align-items-end" method="get">
        <div class="col-12 col-sm-5 col-md-3">
          <label class="form-label small text-muted mb-1">In√≠cio</label>
          <input type="date" name="start" class="form-control" value="{{ start }}">
        </div>
        <div class="col-12 col-sm-5 col-md-3">
          <label class="form-label small text-muted mb-1">Fim</label>
          <input type="date" name="end" class="form-control" value="{{ end }}">
        </div>
        <div class="col-12 col-sm-2 col-md-3 d-grid">
          <button class="btn btn-primary">Filtrar</button>
        </div>
        <div class="col-12 col-md-3 d-grid d-md-flex justify-content-md-end">
          <a class="btn btn-outline-secondary w-100 w-md-auto" href="{{ request.path }}">Limpar</a>
        </div>
      </form>
    </div>
  </div>

  <!-- M√©tricas -->
  <div class="row g-3">
    <div class="col-md-4">
      <div class="metric">
        <div class="ico">üì¶</div>
        <div>
          <div class="text-muted small">Total de pedidos</div>
          <div class="val">{{ agg.total_vendas|default:0 }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="metric">
        <div class="ico">‚úÖ</div>
        <div>
          <div class="text-muted small">Pedidos pagos</div>
          <div class="val">{{ agg.total_pago|default:0 }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="metric">
        <div class="ico">üí∞</div>
        <div>
          <div class="text-muted small">Receita (R$)</div>
          <div class="val">{{ agg.receita|default:"0.00" }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabela -->
  <div class="card card-clean mt-4">
    <div class="card-body">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h2 class="h6 m-0">Top produtos por receita</h2>
      </div>
      <div class="table-responsive">
        <table class="table table-sm table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Produto</th>
              <th class="text-end">Qtd</th>
              <th class="text-end">Receita (R$)</th>
            </tr>
          </thead>
          <tbody>
            {% for row in top %}
              <tr>
                <td class="text-truncate" style="max-width: 420px;" title="{{ row.product__title }}">{{ row.product__title }}</td>
                <td class="text-end">{{ row.qtd }}</td>
                <td class="text-end">{{ row.receita }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="3" class="text-center text-muted py-4">Sem dados no per√≠odo.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>

</body>
</html>
