<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Orçamento {{ orc.numero }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --ring:rgba(37,99,235,.18);
      --g1:#0b1020; --g2:#111a3a; --base-font:14px;
    }
    html{ font-size: var(--base-font); }
    body{ background:#f6f8fb; color:var(--ink); -webkit-print-color-adjust: exact; print-color-adjust: exact; }

    .brand-strip{ height: 10px; background:linear-gradient(90deg,var(--g1),var(--g2)); border-radius:10px 10px 0 0; }
    .doc{ background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 10px 24px rgba(17,24,39,.08); }
    .doc-header{ padding:1rem 1.25rem; border-bottom:1px solid #eef2f7; }
    .doc-body{ padding:1.25rem; }
    .text-muted-2{ color:var(--muted); }
    .kvs dt{ font-size:.8rem; color:var(--muted); margin-bottom:.25rem; }
    .kvs dd{ font-weight:600; margin-bottom:.75rem; }

    .table thead th{
      font-size:.78rem; text-transform:uppercase; letter-spacing:.04em; color:#64748b;
      background:#f8fafc;
    }
    .tfoot-total th, .tfoot-total td{ border-top:2px solid #0b1020; font-weight:800; }
    .sign-line{ border-top:1px solid #cbd5e1; height:48px; }
    .badge-status{ font-size:.8rem; }

    .no-print{ display:block; }

    /* ========= IMPRESSÃO (PAISAGEM) ========= */
    @media print{
      /* força paisagem em A4 (fallbacks amplos para navegadores) */
      @page{
        size: A4 landscape;      /* padrão */
        margin: 14mm;
      }
      /* alguns navegadores respeitam também: */
      html, body { width: 100% !important; }
      body{ background:#fff; }
      .no-print{ display:none !important; }
      .doc{ box-shadow:none; border-color:#cbd5e1; }
      .brand-strip{ border-radius:0; }
      a[href]:after{ content:""; }

      /* usa a largura total da página */
      .container{ max-width: none !important; width: 100% !important; }

      /* evita quebras feias */
      .doc, .doc-header, .doc-body{ break-inside: avoid; }
      table{ break-inside: auto; }
      thead{ display: table-header-group; }
      tfoot{ display: table-footer-group; }
      tr, td, th{ break-inside: avoid; }
    }
  </style>
</head>
<body>
<main class="container my-3 my-lg-4">
  <div class="doc">
    <div class="brand-strip"></div>

    <div class="doc-header">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h1 class="h5 mb-1">Orçamento {{ orc.numero }}</h1>
          <div class="text-muted-2 small">
            Emitido em {{ orc.criado_em|date:"d/m/Y H:i" }} • Válido até {{ validade_ate|date:"d/m/Y" }}
          </div>
        </div>
        <div class="text-end">
          <span class="badge bg-secondary badge-status">{{ orc.get_status_display }}</span>
          <div class="no-print mt-2">
            <button class="btn btn-sm btn-primary" onclick="window.print()">Imprimir</button>
            <a class="btn btn-sm btn-outline-secondary" href="javascript:window.close()">Fechar</a>
          </div>
        </div>
      </div>
    </div>

    <div class="doc-body">
      <!-- Empresa e Cliente -->
      <div class="row g-3 mb-3">
        <div class="col-md-6">
          <h2 class="h6 mb-2">Empresa</h2>
          <dl class="kvs mb-0">
            <dt>Nome</dt><dd>{{ orc.empresa.nome_fantasia|default:"—" }}</dd>
            <dt>CNPJ</dt><dd>{{ orc.empresa.cnpj|default:"—" }}</dd>
            <dt>Contato</dt><dd>{{ orc.empresa.email|default:"—" }} • {{ orc.empresa.telefone|default:"—" }}</dd>
            <dt>Endereço</dt><dd>{{ orc.empresa.endereco|default:"—" }} {{ orc.empresa.cidade }} {{ orc.empresa.estado }}</dd>
          </dl>
        </div>
        <div class="col-md-6">
          <h2 class="h6 mb-2">Cliente</h2>
          <dl class="kvs mb-0">
            <dt>Nome</dt><dd>{{ orc.cliente.nome|default:"—" }}</dd>
            <dt>Documento</dt><dd>{{ orc.cliente.documento|default:"—" }}</dd>
            <dt>Contato</dt><dd>{{ orc.cliente.email|default:"—" }} • {{ orc.cliente.telefone|default:"—" }}</dd>
            <dt>Endereço</dt><dd>{{ orc.cliente.endereco|default:"—" }}</dd>
          </dl>
        </div>
      </div>

      <!-- Itens -->
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th style="width:48%">Produto</th>
              <th class="text-center" style="width:12%">Qtd</th>
              <th class="text-end" style="width:20%">Preço unit. (R$)</th>
              <th class="text-end" style="width:20%">Subtotal (R$)</th>
            </tr>
          </thead>
          <tbody>
            {% for i in orc.itens.all %}
              <tr>
                <td>
                  <div class="fw-semibold">{{ i.produto.nome }}</div>
                  {% if i.descricao_externa %}
                    <div class="small text-muted-2">{{ i.descricao_externa }}</div>
                  {% endif %}
                </td>
                <td class="text-center">{{ i.quantidade }}</td>
                <td class="text-end">{{ i.preco_unitario|floatformat:2 }}</td>
                <td class="text-end">{{ i.subtotal|floatformat:2 }}</td>
              </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="tfoot-total">
              <th colspan="3" class="text-end">Total</th>
              <th class="text-end">R$ {{ orc.valor_total_cache|default:0|floatformat:2 }}</th>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Observações -->
      {% if orc.observacoes %}
        <div class="mt-3">
          <h2 class="h6 mb-1">Observações</h2>
          <div class="text-muted-2">{{ orc.observacoes|linebreaksbr }}</div>
        </div>
      {% endif %}

      <!-- Assinaturas -->
      <div class="row g-4 mt-4">
        <div class="col-md-6 text-center">
          <div class="sign-line"></div>
          <div class="small text-muted-2">Assinatura da Empresa</div>
        </div>
        <div class="col-md-6 text-center">
          <div class="sign-line"></div>
          <div class="small text-muted-2">Assinatura do Cliente</div>
        </div>
      </div>
    </div>
  </div>
</main>

{% if auto %}
<script>window.addEventListener('load', ()=>window.print());</script>
{% endif %}
</body>
</html>
